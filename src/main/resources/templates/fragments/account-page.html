<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head>
</head>
<body>

	<!-- @author Bojan Aleksic -->

	<!-- User Account fragment -->
	<div class="container" th:fragment="user-account">
        <ul class="nav nav-tabs">
            <li class="active"><a th:text="#{tab.my.lingua}" data-toggle="tab" href="#my-lingua">My Lingua</a></li>
            <li><a th:text="#{tab.practice.lingua}" data-toggle="tab" href="#practice-lingua">Practice Lingua</a></li>
        </ul>
        <div class="lingua-container-body">
            <div class="tab-content" style="padding: 50px;">
            	<div id="my-lingua" class="tab-pane fade in active">
	            	<div class="btn-group">
	  					<button type="button" class="btn btn-primary btn-tickets active" id="ticket-all">
	                    	<span class="glyphicon glyphicon-list btn-glyphicons" aria-hidden="true"></span>
	                    	<span th:text="#{tab.all}" class="tab-btn-group">All</span>
	                	</button>
		  				<button type="button" class="btn btn-primary btn-tickets" id="ticket-active">
		                    <span class="glyphicon glyphicon-ok-sign btn-glyphicons" aria-hidden="true"></span>
		                    <span th:text="#{tab.active}" class="tab-btn-group">Active</span>
		                </button>
		                <button type="button" class="btn btn-primary btn-tickets" id="ticket-deleted">
		                    <span class="glyphicon glyphicon-trash btn-glyphicons" aria-hidden="true"></span>
		                    <span th:text="#{tab.deleted}" class="tab-btn-group">Deleted</span>
		                </button>
		  				<button type="button" class="btn btn-primary btn-tickets" id="ticket-moderated">
		                    <span class="glyphicon glyphicon-pencil btn-glyphicons" aria-hidden="true"></span>
		                    <span th:text="#{tab.moderated}" class="tab-btn-group">Moderated</span>
		                </button>
		                <!-- ************ Bootstrap's Modal Button *************** -->
                        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="modal" data-target="#gridSystemModal">
			                <span class="glyphicon glyphicon-plus-sign btn-glyphicons" aria-hidden="true"></span>
                            <span th:text="#{tab.add.new.lingua}" class="tab-btn-group">Add new Lingua</span>
			            </button>
					</div>
					<div class="btn-group add-lingua" role="group">
<!-- 						<div style="float: right;" id="preloader-language"><img th:src="@{/images/preloader.gif}" /></div> -->
						<button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
			                <span class="glyphicon glyphicon-flag btn-glyphicons" aria-hidden="true"></span>
			               	<span th:if="${session.foreignLanguage eq null}" th:text="#{tab.choose.language}" class="tab-btn-group select-practice-lang">Select Language</span>
			               	<span th:if="${session.foreignLanguage ne null}" th:text="${session.foreignLanguage}" class="tab-btn-group select-practice-lang"></span>
			               	<span class="caret"></span>
			            </button>
 			            <ul class="dropdown-menu lingua-language select-language">
 	     					<li th:each="language : ${languages}">
 	     						<a id="selected-lang" href="#" th:text="${language}">Language</a>
 	     					</li>
 	    				</ul>
	    			</div>
	    			
	    			<!-- Include Modal from fragments -->
	    			<div th:replace="fragments/add-lingua-modal :: modal"></div>
	    			
                    <div class="my-lingua-content">
                    
                    	<div id="preloader"><img th:src="@{/images/preloader.gif}" /></div>
                    	
                    	<!-- Here goes content loaded with JSON -->
                    	
                    </div>
                </div>
                <div id="practice-lingua" class="tab-pane fade">
                    <h3>Practice Lingua</h3>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                </div>
            </div>
        </div>
        <script>
	        $(document).ready(function() {
	        	
// 	        	$("#preloader-language").hide();
	        	
// 	        	$(document).ajaxStart(function() {
// 	        		$("#preloader").show();
// 	        	});
	            
// 	            $(document).ajaxComplete(function() {
// 	                $("#preloader").hide();
// 	            });

	        	/* Set/change language */
	        	$(".select-language li > a").click(function() {
	        		
	        		var languageTitle = this.innerHTML;

	        		$.ajax({
	        		    url: 'set-foreign-language',
	        		    type: "POST",
	        		    headers: {
	        		        'Accept': 'application/json',
	        		        'Content-Type': 'application/json'
	        		    },
	        		    dataType: "json",
						data: languageTitle,
	        		    success: function(response) {
	        		    	$(".select-practice-lang").text(response.languageTitle);
	        		    }
	        		});
	        	});
	        	
	        	var selectedCategory = "";
	            
	            $(".select-category li > a").click(function() {
	                $(".category").text(this.innerHTML);
	                selectedCategory = this.innerHTML;
	                $(".selected-category").val(selectedCategory);
	            });
	            
	            $('[data-toggle="tooltip"]').tooltip();
	            
	            var urlRequest = $('.btn.active').attr('id'); // get ID value of active class
	            
	            /* When user is logged in, populate page with all tickets by default */
	            if(urlRequest == "ticket-all") {
	            	$.getJSON(urlRequest, getTickets);
	            }
	
	            /* Get active class on click in button group, and send request to the controller */
				$('.btn-tickets').click(function() {
					console.log("category: " + selectedCategory);
					$("#preloader").show();
					$(".ticket-container").hide();
					
					$(this).addClass('active').siblings().removeClass('active'); // set active class on clicked btn
					urlRequest = $('.btn.active').attr('id');

					$.getJSON(urlRequest, getTickets);
					
				});
	            
				/* Pass data-parsed object from the JSON server to the function */
				function getTickets(data) {
					
					$("#preloader").hide();
					$(".ticket-container").show();
					
					/* This is the parent div in which all content will be populated */
					$(".my-lingua-content").html("");
					
					/* Iterate through data object (list) */
					$.each(data.ticketsList, function(index, ticket) {
						
						var ticketContainerDiv = document.createElement("div");
						ticketContainerDiv.setAttribute("class", "ticket-container");
						
							var ticketHeaderDiv = document.createElement("div");
							ticketHeaderDiv.setAttribute("class", "row ticket-header");
							
								var dateCreatedDiv = document.createElement("div");
								dateCreatedDiv.setAttribute("class", "col-md-2");
									var glyphiconDateSpan = document.createElement("span");
									glyphiconDateSpan.setAttribute("class", "glyphicon glyphicon-time");
									var dateCreatedSpan = document.createElement("span");
									dateCreatedSpan.setAttribute("id", "date-created");
									dateCreatedSpan.appendChild(document.createTextNode(ticket.dateCreated));
							
									dateCreatedDiv.appendChild(glyphiconDateSpan);
									dateCreatedDiv.appendChild(dateCreatedSpan);
							
								var categoryDiv = document.createElement("div");
								categoryDiv.setAttribute("class", "col-md-6");
									var glyphiconCategorySpan = document.createElement("span");
									glyphiconCategorySpan.setAttribute("class", "glyphicon glyphicon-tag");
									var categoryTextSpan = document.createElement("span");
									categoryTextSpan.setAttribute("class", "category-ticket");
									categoryTextSpan.setAttribute("data-toggle", "tooltip");
									categoryTextSpan.setAttribute("title", "Category");
									categoryTextSpan.appendChild(document.createTextNode(ticket.category));
									
									categoryDiv.appendChild(glyphiconCategorySpan);
									categoryDiv.appendChild(categoryTextSpan);
									
								var likeDislikeDiv = document.createElement("div");
								likeDislikeDiv.setAttribute("class", "col-md-4 like-dislike-btn");
									var likeSpan = document.createElement("span");
									likeSpan.setAttribute("class", "glyphicon glyphicon-thumbs-up");
									likeSpan.setAttribute("data-toggle", "tooltip");
									likeSpan.setAttribute("title", "Like");
									likeDislikeDiv.appendChild(likeSpan);
									
									var likeSpanVotes = document.createElement("span");
									likeSpanVotes.setAttribute("class", "like-vote-value");
									likeSpanVotes.appendChild(document.createTextNode(ticket.votesUp[0].voteValue));
									likeDislikeDiv.appendChild(likeSpanVotes);
									
									var dislikeSpan = document.createElement("span");
									dislikeSpan.setAttribute("class", "glyphicon glyphicon-thumbs-down");
									dislikeSpan.setAttribute("data-toggle", "tooltip");
									dislikeSpan.setAttribute("title", "Dislike");
									likeDislikeDiv.appendChild(dislikeSpan);
									
									var dislikeSpanVotes = document.createElement("span");
									dislikeSpanVotes.appendChild(document.createTextNode(ticket.votesDown[0].voteValue));
									likeDislikeDiv.appendChild(dislikeSpanVotes);
									
								ticketHeaderDiv.appendChild(dateCreatedDiv);
								ticketHeaderDiv.appendChild(categoryDiv);
								ticketHeaderDiv.appendChild(likeDislikeDiv);
								
							ticketContainerDiv.appendChild(ticketHeaderDiv);
								
							var domesticForeignDiv = document.createElement("div");
							domesticForeignDiv.setAttribute("class", "row domestic-foreign-row");
							var domesticDiv = document.createElement("div");
							domesticDiv.setAttribute("id", "text-domestic");
							domesticDiv.setAttribute("class", "col-md-6 domestic-foreign-text");
							domesticDiv.appendChild(document.createTextNode(ticket.textDomestic));
							domesticForeignDiv.appendChild(domesticDiv);
							
							var foreignDiv = document.createElement("div");
							foreignDiv.setAttribute("id", "text-foreign");
							foreignDiv.setAttribute("class", "col-md-6 domestic-foreign-text");
							foreignDiv.appendChild(document.createTextNode(ticket.textForeign));
							domesticForeignDiv.appendChild(foreignDiv);
							
						ticketContainerDiv.appendChild(domesticForeignDiv);
						
						$(".my-lingua-content").append(ticketContainerDiv);
						
					});
				}
				
	        });
    	</script>
    </div>
    
    <!-- Administrator Account fragment -->
	<div class="container" th:fragment="admin-account">
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#moderate-users">Moderate Users</a></li>
            <li><a data-toggle="tab" href="#moderate-lingua">Moderate Lingua</a></li>
            <li><a data-toggle="tab" href="#reports">Reports</a></li>
        </ul>
        <div class="lingua-container-body">
            <div class="tab-content" style="padding: 50px;">
            	<div id="moderate-users" class="tab-pane fade in active">
            		<h3>Moderate Users</h3>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                </div>
                <div id="moderate-lingua" class="tab-pane fade">
                    <h3>Moderate Lingua</h3>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                </div>
                <div id="reports" class="tab-pane fade">
                    <h3>Reports</h3>
                    <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                </div>
            </div>
        </div>
    </div>
	
</body>
</html>